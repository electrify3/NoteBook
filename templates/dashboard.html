{% extends "base.html" %}

{% block content %}
<div class="dashboard-grid">
    <div class="sidebar">
        <h3>Folders</h3>
        <form action="{{ url_for('create_folder') }}" method="POST" style="margin-bottom: 1rem;">
            <input type="text" name="name" placeholder="New Folder Name" required style="margin-bottom: 0.5rem;">
            <button type="submit" style="width: 100%; padding: 0.5rem;">+ Add Folder</button>
        </form>
        <ul class="folder-list">
            <li class="folder-item {% if not active_folder %}active{% endif %}">
                <a href="{{ url_for('dashboard') }}" style="text-decoration: none; color: inherit; display: block;">All
                    Notes</a>
            </li>
            {% for folder in folders %}
            <li
                class="folder-item {% if active_folder and active_folder|string == folder._id|string %}active{% endif %}">
                <a href="{{ url_for('dashboard', folder_id=folder._id) }}"
                    style="text-decoration: none; color: inherit; display: block;">
                    {{ folder.name }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="main-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h2>
                {% if active_folder_name %}
                {{ active_folder_name }}
                <button onclick="document.getElementById('rename-form').style.display='inline-block'"
                    class="btn-rename">Rename</button>
                <form id="rename-form" action="{{ url_for('rename_folder', folder_id=active_folder) }}" method="POST"
                    style="display: none; margin-left: 0.5rem;">
                    <input type="text" name="new_name" value="{{ active_folder_name }}" required>
                    <button type="submit" style="padding: 0.25rem 0.5rem;">Save</button>
                    <button type="button" onclick="document.getElementById('rename-form').style.display='none'"
                        style="background-color: transparent; color: var(--text-muted); padding: 0.25rem;">Cancel</button>
                </form>
                {% else %}
                All Notes
                {% endif %}
            </h2>

            <div style="display: flex; gap: 1rem;">
                <form action="{{ url_for('search') }}" method="GET" style="display: flex; gap: 0.5rem;">
                    <input type="text" name="q" placeholder="Search notes..." value="{{ request.args.get('q', '') }}">
                    <button type="submit">Search</button>
                </form>
                <a href="{{ url_for('new_note', folder_id=active_folder) }}" class="button"
                    style="background-color: var(--primary-color); color: white; padding: 0.75rem 1.5rem; text-decoration: none; border-radius: 0.375rem;">+
                    New Note</a>
            </div>
        </div>

        <div class="notes-list">
            {% for note in notes %}
            <a href="{{ url_for('view_note', note_id=note._id) }}" style="text-decoration: none; color: inherit;">
                <div class="note-card">
                    <h3 style="margin-top: 0;">{{ note.title }}</h3>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">
                        {% if note.content %}
                        {{ note.content[:100] }}...
                        {% else %}
                        <span style="font-style: italic; color: #9ca3af;">No content</span>
                        {% endif %}
                    </p>
                    <small style="color: var(--text-muted);">{{ note.updated_at.strftime('%Y-%m-%d') }}</small>
                </div>
            </a>
            {% else %}
            <p>No notes found.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}